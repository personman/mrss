<h2>Benchmarks</h2>

<ul>
    <li>
        <a href="<?= $this->url(
            'benchmarkgroups/add',
            array('study' => $study->getId())
        )?>">
            Add a benchmark group
        </a>
    </li>
</ul>

<?php foreach ($this->benchmarkGroups as $benchmarkGroup): ?>
    <h3><?= $benchmarkGroup->getName() ?></h3>

    <ul>
        <li>
            <a href="<?= $this->url(
                'benchmarkgroups/edit',
                array('id' => $benchmarkGroup->getId())
            ) ?>">Edit benchmark group</a>
        </li>

        <li>
            <a href="<?= $this->url(
                'benchmarks/add',
                array('benchmarkGroup' => $benchmarkGroup->getId())
            ) ?>">Add benchmark</a>
        </li>
    </ul>

    <table class="table table-striped heatmap">
        <thead>
            <tr>
                <th>Benchmark</th>
                <th>Action</th>
                <?php foreach ($this->yearsToShow as $year): ?>
                    <th><?= $year ?></th>
                <?php endforeach ?>
            </tr>
        </thead>
        <tbody>
        <?php foreach ($benchmarkGroup->getBenchmarks() as $benchmark): ?>
            <tr>
                <td>
                    <a href="<?= $this->url(
                        'benchmarks/view',
                        array(
                            'id' => $benchmark->getId()
                        )
                    ) ?>">
                        <?= $benchmark->getName() ?>
                    </a>
                </td>

                <td>
                    <a href="<?= $this->url(
                        'benchmarks/edit',
                        array(
                            'id' => $benchmark->getId()
                        )
                    ) ?>">Edit</a>
                </td>

                <?php foreach ($this->yearsToShow as $year): ?>
                    <td>
                        <?php if ($benchmark->isAvailableForYear($year)): ?>
                            <? $percentage = round(
                                $benchmark->getCompletionPercentage($year)
                            )?>
                            <div
                                class="heatmapCell heatmapCellBlue"
                                style="opacity: <?= $percentage / 100 ?>">
                                <?= $percentage ?>%
                            </div>
                        <?php else: ?>
                            <div style="color:#ccc; text-align:center">N/A</div>
                        <?php endif ?>
                    </td>
                <?php endforeach ?>
            </tr>
        <?php endforeach ?>
        </tbody>
    </table>
<?php endforeach ?>
